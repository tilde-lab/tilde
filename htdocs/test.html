<!DOCTYPE html>
<head>
<meta charset="utf-8">
<style>
*{font-family:"Courier New";margin:0;padding:0;}

.link {
  fill: none;
  stroke: #ccc;
  stroke-width: 1px;
}

#licensing {
  fill: green;
}

.link.influences {
  stroke: #ccc;
}

.link.belongs {
    stroke: #ccc;
}

circle {
  fill: #fff;
  stroke: #ccc;
  stroke-width: 1px;
  cursor:pointer;
}

text {
  font-size:12px;
  font-weight:bold;
  cursor:pointer;
  text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff;
}

text.shadow {
  stroke: #fff;
  stroke-width: 3px;
  stroke-opacity: .8;
}
</style>

<script type="text/javascript" src="/static/d3.v3.min.js"></script>
</head>
<body>

<script type="text/javascript">
var graph = {"edges": [{"target": "Input file", "source": "File location", "type": "belongs"}, {"target": "Groundstate setup", "source": "Cell", "type": "belongs"}, {"target": "Input file", "source": "Modeling time", "type": "belongs"}, {"target": "Relaxation setup", "source": "Relax algorithm", "type": "belongs"}, {"target": "2D properties", "source": "Termination", "type": "belongs"}, {"target": "Phonon properties", "source": "Modes", "type": "belongs"}, {"target": "Input", "source": "Correctly finished", "type": "belongs"}, {"target": "Stoichiometric properties", "source": "N atoms per cell", "type": "belongs"}, {"target": "Input", "source": "Groundstate setup", "type": "belongs"}, {"target": "Cell", "source": "Cell dimensions", "type": "belongs"}, {"target": "Input file", "source": "Text representation", "type": "belongs"}, {"target": "Stoichiometric properties", "source": "Containing elements", "type": "belongs"}, {"target": "Defects", "source": "Vacancies", "type": "belongs"}, {"target": "Groundstate setup", "source": "Sphere radius", "type": "belongs"}, {"target": "Phonon properties", "source": "Phonon DOS", "type": "belongs"}, {"target": "Phonon properties", "source": "Frequencies", "type": "belongs"}, {"target": "Groundstate setup", "source": "RGKmax", "type": "belongs"}, {"target": "Electron properties", "source": "Electron band structure", "type": "belongs"}, {"target": "Stoichiometric properties", "source": "Host elements number", "type": "belongs"}, {"target": "Electron properties", "source": "Electron DOS", "type": "belongs"}, {"target": "Input", "source": "Phonon setup", "type": "belongs"}, {"target": "Input", "source": "Input file", "type": "belongs"}, {"target": "2D properties", "source": "Thickness", "type": "belongs"}, {"target": "Stoichiometric properties", "source": "Chemical formula", "type": "belongs"}, {"target": "2D properties", "source": "Adsorbent", "type": "belongs"}, {"target": "Symmetry", "source": "Syngony", "type": "belongs"}, {"target": "Stoichiometric properties", "source": "Formula units", "type": "belongs"}, {"target": "Electron properties", "source": "Band gap", "type": "belongs"}, {"target": "Stoichiometric properties", "source": "Defects", "type": "belongs"}, {"target": "Symmetry", "source": "Space group (shoen.)", "type": "belongs"}, {"target": "Cell", "source": "Symmetry", "type": "belongs"}, {"target": "Groundstate setup", "source": "K-mesh", "type": "belongs"}, {"target": "Groundstate setup", "source": "Basis set", "type": "belongs"}, {"target": "Input", "source": "Code version", "type": "belongs"}, {"target": "Input file", "source": "Parsing time", "type": "belongs"}, {"target": "Groundstate setup", "source": "Spin-polarization", "type": "belongs"}, {"target": "2D properties", "source": "Vacuum", "type": "belongs"}, {"target": "Electron properties", "source": "Band gap type", "type": "belongs"}, {"target": "Phonon setup", "source": "Phonon magnitude", "type": "belongs"}, {"target": "Input", "source": "Relaxation setup", "type": "belongs"}, {"target": "Symmetry", "source": "Space group (int.)", "type": "belongs"}, {"target": "Symmetry", "source": "Layer group", "type": "belongs"}, {"target": "Cell", "source": "Cell vectors", "type": "belongs"}, {"target": "Defects", "source": "Impurities", "type": "belongs"}, {"target": "Groundstate setup", "source": "2D properties", "type": "belongs"}, {"target": "Phonon properties", "source": "Phonon band structure", "type": "belongs"}, {"target": "Symmetry", "source": "Point group", "type": "belongs"}, {"target": "Relaxation setup", "source": "Force tolerance", "type": "belongs"}, {"target": "Electron properties", "source": "Conductivity of current", "type": "belongs"}, {"target": "Groundstate setup", "source": "Hamiltonian", "type": "belongs"}, {"target": "Phonon properties", "source": "Phonon setup", "type": "influences"}, {"target": "Phonon band structure", "source": "Symmetry", "type": "influences"}, {"target": "Phonon properties", "source": "Stoichiometric properties", "type": "influences"}, {"target": "Electron band structure", "source": "Symmetry", "type": "influences"}, {"target": "E tot", "source": "Groundstate setup", "type": "influences"}, {"target": "Phonon properties", "source": "Groundstate setup", "type": "influences"}, {"target": "Electron properties", "source": "Stoichiometric properties", "type": "influences"}, {"target": "Cell", "source": "Relaxation setup", "type": "influences"}, {"target": "Electron properties", "source": "Groundstate setup", "type": "influences"}], "vertices": ["Band gap type", "Basis set", "Phonon magnitude", "Stoichiometric properties", "Electron band structure", "Cell", "Text representation", "RGKmax", "Phonon setup", "Input", "Groundstate setup", "Cell vectors", "Containing elements", "Relaxation setup", "Force tolerance", "Phonon DOS", "Adsorbent", "Code version", "2D properties", "Frequencies", "Hamiltonian", "Thickness", "Electron properties", "Impurities", "K-mesh", "Vacuum", "Conductivity of current", "Defects", "Phonon properties", "Host elements number", "Modes", "Parsing time", "Correctly finished", "Vacancies", "N atoms per cell", "Symmetry", "Spin-polarization", "Sphere radius", "Space group (shoen.)", "Chemical formula", "Layer group", "Space group (int.)", "Point group", "Modeling time", "Electron DOS", "Formula units", "Periodicity", "Input file", "Termination", "Band gap", "File location", "Cell dimensions", "Relax algorithm", "Phonon band structure", "Syngony", "E tot"]}

var nodes = {};

// Compute the distinct nodes from the links
graph.edges.forEach(function(link) {
  link.source = nodes[link.source] || (nodes[link.source] = {name: link.source});
  link.target = nodes[link.target] || (nodes[link.target] = {name: link.target});
});

var width = document.body.clientWidth,
    height = 1500;

var force = d3.layout.force()
    .nodes(d3.values(nodes))
    .links(graph.edges)
    .size([width, height*=2/3])
    .linkDistance(130)
    .gravity(0.06)
    .charge(-400)
    .on("tick", tick)
    .start();

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);
    
// Per-type markers, as they don't inherit styles.
/*svg.append("defs").selectAll("marker")
    .data(["belongs", "influences"])
  .enter().append("marker")
    .attr("id", function(d){return d})
    .attr("viewBox", "0 -5 10 10")
    .attr("refX", 15)
    .attr("refY", -1.5)
    .attr("markerWidth", 6)
    .attr("markerHeight", 6)
    .attr("orient", "auto")
  .append("path")
    .attr("d", "M0,-5L10,0L0,5").style("fill", "#ccc");*/

var path = svg.append("g").selectAll("path")
    .data(force.links())
  .enter().append("path")
    .attr("class", function(d) { return "link " + d.type; })
    .attr("marker-end", function(d) { return "url(#" + d.type + ")"; });

var circle = svg.append("g").selectAll("circle")
    .data(force.nodes())
  .enter().append("circle")
    .attr("r", 8)
    .call(force.drag);

var text = svg.append("svg:g").selectAll("g")
    .data(force.nodes())
  .enter().append("svg:g");

// A copy of the text with a thick white stroke for legibility.
text.append("text")
    .attr("x", 12)
    .attr("y", ".31em")
    .attr("class", "shadow")
    .text(function(d) { return d.name; });

text.append("text")
    .attr("x", 12)
    .attr("y", ".31em")
    .text(function(d) { return d.name; });

// Use elliptical arc path segments target doubly-encode directionality.
function tick() {        
  path.attr("d", direct);
  circle.attr("transform", transform);
  text.attr("transform", transform);
}

function direct(d) {
  return "M" + d.source.x + "," + d.source.y + " " + d.target.x + "," + d.target.y;
}

function transform(d) {
  return "translate(" + d.x + "," + d.y + ")";
}

var s=0;
while(force.alpha() > 0.06) {
    force.tick();
    if(s++ > 500) break;
}

circle.on("click", function(d) { handle(d) })
text.on("click", function(d) { handle(d) })

function handle(x){
    console.log(x)
}

</script>


</body>
</html>
